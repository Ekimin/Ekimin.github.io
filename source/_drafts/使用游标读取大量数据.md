title: JDBC使用游标分页读取大量数据
date: 2015-12-25
tags: [java, 数据库]
categories: java
layout: post
updated: 
comments: 
permalink: 
---

今天同步mysql中一张很大的表到另外一个数据库，折腾了半天写的程序报OOM。后来使用了limit限制每次读取量，新的问题又来了：程序跑到后面莫名卡死，而且效率低下。
各种搜索，发现原来jdbc有游标分页读取的功能。

<!--more-->

MySQL JDBC默认客户端数据接收方式为从服务器一次取出所有数据放在客户端内存中，fetch size参数不起作用，当一条SQL返回数据量较大时可能会出现JVM OOM。

解决方法：

1. 设置Statement/PreparedStatement读取方式为流式读取。
```java
setResultSetType(ResultSet.TYPE_FORWARD_ONLY);
setFetchSize(Integer.MIN_VALUE);
```

2. 
